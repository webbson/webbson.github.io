{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/get-a-list-of-sitecore-users/","result":{"data":{"site":{"siteMetadata":{"title":"Tom's tech blog"}},"markdownRemark":{"id":"78e614a2-c539-5810-be2a-a62e4462b56f","excerpt":"Recently I got tasked with exporting a list of all users in a clients Sitecore installation. My immidiate though was to use Sitecore Powershell as I could writeâ€¦","html":"<p>Recently I got tasked with exporting a list of all users in a clients Sitecore installation. My immidiate though was to use <a href=\"https://doc.sitecorepowershell.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Sitecore Powershell</a> as I could write the code quick and easy without having to deploy code to their production environment.</p>\n<p>For my first attempt I used the function <a href=\"https://doc.sitecorepowershell.com/appendix/security/get-user\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>Get-User -Filter *</code></a> which gives a list of users in Sitecore. The properties of these users are quite limited however and I didn't find an easy way to get properties like email and comments from them.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Name            <span class=\"token builtin class-name\">:</span> sitecore<span class=\"token punctuation\">\\</span>adminUser\nDomain          <span class=\"token builtin class-name\">:</span> sitecore\nIsAdministrator <span class=\"token builtin class-name\">:</span> True\nIsAuthenticated <span class=\"token builtin class-name\">:</span> False\nIsEnabled       <span class=\"token builtin class-name\">:</span> True</code></pre></div>\n<p>After quite a lot of Googling I found the command <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.web.security.membership.getallusers?view=netframework-4.8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>[System.Web.Security.Membership]::GetAllUsers()</code></a> which get another list of users. This list contains almost all the properties I could wish for. It was however missing properties for knowing if the user was administrator or which groups it has.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Comment                 <span class=\"token builtin class-name\">:</span> Is Admin\nCreationDate            <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>/23/2018 <span class=\"token number\">2</span>:02:45 PM\nEmail                   <span class=\"token builtin class-name\">:</span> adminUser@client.com\nInnerUser               <span class=\"token builtin class-name\">:</span> sitecore<span class=\"token punctuation\">\\</span>adminUser\nIsApproved              <span class=\"token builtin class-name\">:</span> True\nIsLockedOut             <span class=\"token builtin class-name\">:</span> False\nLastActivityDate        <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>/9/2021 <span class=\"token number\">9</span>:28:32 AM\nLastLockoutDate         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1</span>/1/1754 <span class=\"token number\">12</span>:00:00 AM\nLastLoginDate           <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2</span>/9/2021 <span class=\"token number\">9</span>:27:55 AM\nLastPasswordChangedDate <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>/23/2018 <span class=\"token number\">2</span>:02:45 PM\nPasswordQuestion        <span class=\"token builtin class-name\">:</span>\nProviderName            <span class=\"token builtin class-name\">:</span> sitecore\nProviderUserKey         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">11111111</span>-1111-1111-1111-111111111111\nUserName                <span class=\"token builtin class-name\">:</span> sitecore<span class=\"token punctuation\">\\</span>adminUser\nIsOnline                <span class=\"token builtin class-name\">:</span> False</code></pre></div>\n<p>The solution was then to combine the two. I choose the way of fetching the users with the <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.web.security.membership.getallusers?view=netframework-4.8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>[System.Web.Security.Membership]::GetAllUsers()</code></a> command, and then iterating over them and then getting the user from the <a href=\"https://doc.sitecorepowershell.com/appendix/security/get-user\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code>Get-User -Id $user.UserName</code></a> command and expanding the user object with the properties I needed from that.</p>\n<p>The final script looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$userList</span> = <span class=\"token namespace\">[System.Web.Security.Membership]</span>::GetAllUsers<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span> in <span class=\"token variable\">$userList</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$euser</span> = <span class=\"token function\">Get-User</span> <span class=\"token operator\">-</span>Id <span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>UserName\n    <span class=\"token function\">Add-Member</span> <span class=\"token operator\">-</span>InputObject <span class=\"token variable\">$user</span> <span class=\"token operator\">-</span>MemberType NoteProperty <span class=\"token operator\">-</span>Name <span class=\"token string\">\"IsAdministrator\"</span> <span class=\"token operator\">-</span>Value <span class=\"token variable\">$euser</span><span class=\"token punctuation\">.</span>IsAdministrator\n<span class=\"token punctuation\">}</span>\n<span class=\"token variable\">$users</span> = <span class=\"token variable\">$userList</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>Label=<span class=\"token string\">\"Email\"</span><span class=\"token punctuation\">;</span> Expression=<span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Email<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    @<span class=\"token punctuation\">{</span>Label=<span class=\"token string\">\"Is admin\"</span><span class=\"token punctuation\">;</span> Expression=<span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>IsAdministrator<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    @<span class=\"token punctuation\">{</span>Label=<span class=\"token string\">\"Username\"</span><span class=\"token punctuation\">;</span> Expression=<span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>UserName<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    @<span class=\"token punctuation\">{</span>Label=<span class=\"token string\">\"Comment\"</span><span class=\"token punctuation\">;</span> Expression=<span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Comment<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    @<span class=\"token punctuation\">{</span>Label=<span class=\"token string\">\"Last logged in\"</span><span class=\"token punctuation\">;</span> Expression=<span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>LastLoginDate<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$props</span> = @<span class=\"token punctuation\">{</span>\n    Title = <span class=\"token string\">\"Export user data\"</span>\n    InfoTitle = <span class=\"token string\">\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$users</span><span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">)</span></span> users\"</span>\n    InfoDescription = <span class=\"token string\">\"Export user data\"</span>\n    PageSize = 200\n<span class=\"token punctuation\">}</span>\n<span class=\"token variable\">$users</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Show-ListView</span> @props</code></pre></div>\n<p>It renders as <a href=\"https://doc.sitecorepowershell.com/appendix/common/show-listview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">listview</a> in Sitecore Powershell, in this the records can be sorted by the different columns and then exported to a variety of formats.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1229px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e5adc4e75c1536ae897547387b456d77/1dae5/userlist.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAX9NoCS4/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECEwMQM//aAAgBAQABBQJY4tUopRDnr//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAEDBQAAAAAAAAAAAAAAAAADMpICEBESgf/aAAgBAQAGPwLOtERqcRqcTt//xAAWEAEBAQAAAAAAAAAAAAAAAAAQcfD/2gAIAQEAAT8hYtxmlf/aAAwDAQACAAMAAAAQsw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAACAQMFAQAAAAAAAAAAAAAAAXEhMbERQVHB0fD/2gAIAQEAAT8Qa1ek9KvzIq2X6L6nZdlgK7kW8n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e5adc4e75c1536ae897547387b456d77/884e7/userlist.avif 480w,\n/static/e5adc4e75c1536ae897547387b456d77/542bc/userlist.avif 960w,\n/static/e5adc4e75c1536ae897547387b456d77/74c0d/userlist.avif 1229w\"\n              sizes=\"(max-width: 1229px) 100vw, 1229px\"\n              type=\"image/avif\"\n            /><source\n              srcset=\"/static/e5adc4e75c1536ae897547387b456d77/d3be9/userlist.webp 480w,\n/static/e5adc4e75c1536ae897547387b456d77/e46b2/userlist.webp 960w,\n/static/e5adc4e75c1536ae897547387b456d77/24859/userlist.webp 1229w\"\n              sizes=\"(max-width: 1229px) 100vw, 1229px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e5adc4e75c1536ae897547387b456d77/7cc5e/userlist.jpg 480w,\n/static/e5adc4e75c1536ae897547387b456d77/6a068/userlist.jpg 960w,\n/static/e5adc4e75c1536ae897547387b456d77/1dae5/userlist.jpg 1229w\"\n            sizes=\"(max-width: 1229px) 100vw, 1229px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e5adc4e75c1536ae897547387b456d77/1dae5/userlist.jpg\"\n            alt=\"List of users\"\n            title=\"List of users\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>","frontmatter":{"title":"Get an exportable list of users in Sitecore using Sitecore Powershell","date":"February 09, 2021","description":"Here I will show how to get a list of users in Sitecore which can be exported to an Excel or CSV file.","tags":["sitecore","powershell"]}},"previous":{"fields":{"slug":"/sitecore-database-maintenance/"},"frontmatter":{"title":"Sitecore database maintenance"}},"next":{"fields":{"slug":"/gosund-sp111-esphome/"},"frontmatter":{"title":"Gosund SP111 outlet flashed to ESPHome"}}},"pageContext":{"id":"78e614a2-c539-5810-be2a-a62e4462b56f","previousPostId":"39a2924a-4c28-5494-9917-8693a92efdc5","nextPostId":"4c7462e6-ace1-52fe-8b92-e43d6266b87b"}},"staticQueryHashes":["2841359383","3700319767"]}