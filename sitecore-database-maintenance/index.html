<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d0eb569acf6d40b38a97.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}body,html{margin:0;padding:0}body{background-color:var(--outside);overflow-y:scroll;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;font-size:16px}*{box-sizing:border-box}.wrapper{max-width:var(--max-content);margin:0 auto;background-color:var(--text-area);color:var(--text-color);min-height:100vh;opacity:0;transition:max-width .5s ease,color .5s ease,background-color .5s ease,opacity .5s ease .5s}.wrapper.wide{max-width:var(--max-content-wide)}.wrapper.dark{background-color:var(--text-area-dark)}.wrapper.dark,.wrapper.dark main a{color:var(--text-color-dark)}.wrapper.loaded{opacity:1}main{width:100%;padding:2em}main a{color:var(--text-color)}.gatsby-highlight{border:1px solid var(--accent)}.gatsby-highlight>*{margin:0!important}hr{border:1px solid var(--accent);margin:20px 0}.blog-post>section>table{border-collapse:collapse}.blog-post>section>table td,.blog-post>section>table th{border:1px solid var(--accent);padding:5px 15px;text-align:left}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}:root{--max-content:768px;--max-content-wide:1920px;--mobile-max:767px;--desktop:768px;--text-area:#efefef;--text-color:#303030;--outside:#606060;--outside-text:#efefef;--accent:#d6ed17;--text-area-dark:#303030;--text-color-dark:#efefef}.navigation-module--nav--ziCcR{background-color:var(--outside);padding:1em;border-bottom:2px solid var(--accent);display:flex;justify-content:space-between}.navigation-module--title--1-2_e{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}.navigation-module--link--2JAmB,.navigation-module--title--1-2_e{color:var(--outside-text);text-decoration:none;text-transform:lowercase}.navigation-module--link--2JAmB+.navigation-module--link--2JAmB{margin-left:15px}.navigation-module--toggle--m6_mB{background-color:transparent;border:0;outline:none;margin-left:15px;cursor:pointer;padding:0}.navigation-module--toggle--m6_mB svg{width:20px;height:20px}.navigation-module--toggle--m6_mB svg path{fill:#efefef}.navigation-module--wideToggle--19L19{display:none}@media (min-width:868px){.navigation-module--wideToggle--19L19{display:inline-block}}.postlist-module--post--2yiXG{padding:20px 0}.postlist-module--post--2yiXG+.postlist-module--post--2yiXG{border-top:1px solid var(--accent)}.postlist-module--url--3iZEY{color:var(--text-color);text-decoration:none}.postlist-module--title--2h6OQ{margin:0 0 10px;padding:0}.postlist-module--date--3mNmA{font-weight:200;margin-right:20px}.postlist-module--excerpt--2c4Oy{margin:0;padding:10px 0 0}.tags-module--tag--2glfG{font-size:10px;font-weight:700;padding:5px;background-color:var(--accent);text-decoration:none;position:relative;transition:color .5s ease}.tags-module--tag--2glfG span{color:var(--text-color)}.tags-module--tag--2glfG:before{z-index:0;content:"";position:absolute;top:0;left:0;width:100%;height:100%;display:block;background-color:transparent;transition:background-color .5s ease}.tags-module--tag--2glfG:hover:before{background-color:rgba(0,0,0,.4)}.tags-module--tag--2glfG+.tags-module--tag--2glfG{margin:0 0 0 10px}.tags-module--innerTag--onR-U{position:relative;z-index:2;display:inline-block}</style><meta name="generator" content="Gatsby 2.28.2"/><link href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css" rel="stylesheet"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=cb0a1f4cf9826b88bdfab88879b59d76" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#d6ed17"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=cb0a1f4cf9826b88bdfab88879b59d76"/><title data-react-helmet="true">Sitecore database maintenance | Tom&#x27;s tech blog</title><meta data-react-helmet="true" name="description" content="Some steps to make sure that Sitecore runs as smooth as possible."/><meta data-react-helmet="true" property="og:title" content="Sitecore database maintenance"/><meta data-react-helmet="true" property="og:description" content="Some steps to make sure that Sitecore runs as smooth as possible."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="webbson_"/><meta data-react-helmet="true" name="twitter:title" content="Sitecore database maintenance"/><meta data-react-helmet="true" name="twitter:description" content="Some steps to make sure that Sitecore runs as smooth as possible."/><link as="script" rel="preload" href="/webpack-runtime-075b5726bcd5216af51a.js"/><link as="script" rel="preload" href="/framework-cd3e1e804d552fa282ef.js"/><link as="script" rel="preload" href="/app-4dcf017b93828f5893f6.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/commons-860bd8c08d74af16f8c7.js"/><link as="script" rel="preload" href="/f392fca177af3aab4cc1b9f9883337b948fd7c96-f84e27f836a0b0d63dc2.js"/><link as="script" rel="preload" href="/b7ec4a9a53c2f60dbf6d272eea6248b905830475-fa24200736daf2b6b0f4.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-jsx-b61ec52d5f6953dc41cc.js"/><link as="fetch" rel="preload" href="/page-data/sitecore-database-maintenance/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3700319767.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="wrapper" data-is-root-path="false"><nav class="navigation-module--nav--ziCcR"><a class="navigation-module--title--1-2_e" href="/">Tom&#x27;s tech blog</a><div><a class="navigation-module--toggle--m6_mB navigation-module--link--2JAmB" href="/about"><svg viewBox="0 0 16 16" aria-hidden="true" focusable="false" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="StyledIconBase-ea9ulj-0 jZGNBW"><path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 010-2.098L6.95.435zm1.4.7a.495.495 0 00-.7 0L1.134 7.65a.495.495 0 000 .7l6.516 6.516a.495.495 0 00.7 0l6.516-6.516a.495.495 0 000-.7L8.35 1.134z"></path><path d="M5.255 5.786a.237.237 0 00.241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 00.25.246h.811a.25.25 0 00.25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"></path></svg></a><button class="navigation-module--toggle--m6_mB navigation-module--wideToggle--19L19"><svg viewBox="0 0 16 16" aria-hidden="true" focusable="false" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="StyledIconBase-ea9ulj-0 jZGNBW"><path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 00-.707 0l-4.096 4.096V11.5a.5.5 0 00-1 0v3.975a.5.5 0 00.5.5H4.5a.5.5 0 000-1H1.732l4.096-4.096a.5.5 0 000-.707zm4.344-4.344a.5.5 0 00.707 0l4.096-4.096V4.5a.5.5 0 101 0V.525a.5.5 0 00-.5-.5H11.5a.5.5 0 000 1h2.768l-4.096 4.096a.5.5 0 000 .707z"></path></svg></button><button class="navigation-module--toggle--m6_mB"><svg viewBox="0 0 352 512" aria-hidden="true" focusable="false" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="StyledIconBase-ea9ulj-0 jZGNBW"><path fill="currentColor" d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0026.64 14.28h61.71a31.99 31.99 0 0026.64-14.28l17.09-25.69a31.989 31.989 0 005.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></button></div></nav><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Sitecore database maintenance</h1><a class="tags-module--tag--2glfG" href="/tags/sitecore"><span class="tags-module--innerTag--onR-U">sitecore</span></a><a class="tags-module--tag--2glfG" href="/tags/database"><span class="tags-module--innerTag--onR-U">database</span></a><a class="tags-module--tag--2glfG" href="/tags/performance"><span class="tags-module--innerTag--onR-U">performance</span></a><p>April 07, 2021</p></header><section itemProp="articleBody"><p>One of my clients Sitecore installation started to get more and more bogged down and irresponsive. These are some basic steps I took to make sure that the databases of the solution is running as smooth as possible.</p>
<p>The steps I took was:</p>
<ul>
<li><a href="#empty">Emtpty recycle bin of old items</a></li>
<li><a href="#cleanup">Clean up databases</a></li>
<li><a href="#fragmentation">SQL Fragmentation</a></li>
<li><a href="#remove">Remove old item versions</a></li>
</ul>
<h1>Emtpty recycle bin of old items <a id="empty"></a></h1>
<p>The recycle bin had over 10 000 items dating back more than 3 years. Cleaning out everything older than a month will make it a bit lighter. This is easy to do by going into the dashboard and running the <code class="language-text">Clean up deleted items</code> task under DATABASE.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 871px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f32b35cf3fb73b5d7f8192c550cd6d31/9d5da/deleted-items.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByElEQVQoz22RO28aURCF+RuU0PITMH+FZ+FQhgpB5aVAxsuCgEX7BJaHnSxI20VKYSmBSDg4idKnSRNFWidWgg1ZZDsnMxfJjbPS0dxZab575tyQoWvoqm202x1omgbDMKDr+hMp9Tpqx8eonZygVquh0Wg8qtlsQlEUqKqKkK6paDdlyHUF3W73CZD7TqeDZ4eHyKTTyGQyyGazSNM5lUohmUwil8sJSZKEkGVZNETD2h7Q7/cxGAwwHA7hOA4mkwlarRYSiQTiBweIx+OixmIxRKNRoUgkgnA4jHw+z0AbDLVMEyaJa8+2MRqNBHQ8HsOmXpKOhAPpaF8rlQrK5TJKpRKKxSIKhQJkWd475AHDNGDT2Tk7g3N6KmAMZbfT6RRXP35ifbvB7/UNdrsd/vctl8s90DJpbc6MwLNqFTMK2iFnI4Iy0HVf4rt/hfVmi22ww+1mg7tgS4i/QvcPDwK4WCwQYnecG69pUWYeveSMXm1I2Y3JIefoui5830cQBPhDwv0dPn27RnXxBe+/+rj5dS3+CyDn1uv1HmWSK4tc8QXc8wYMnc/nWK1WWF1e4vPHD3jx+g2e2x4mr87xbv4Wy4sLeJ6Hf9HNzaMu8Y3XAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Clean up deleted items"
        title="Clean up deleted items"
        src="/static/f32b35cf3fb73b5d7f8192c550cd6d31/9d5da/deleted-items.png"
        srcset="/static/f32b35cf3fb73b5d7f8192c550cd6d31/e85cb/deleted-items.png 480w,
/static/f32b35cf3fb73b5d7f8192c550cd6d31/9d5da/deleted-items.png 871w"
        sizes="(max-width: 871px) 100vw, 871px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h1>Clean up databases <a id="cleanup"></a></h1>
<p>In the same menu there is an alternative called <code class="language-text">Clean up databases</code>, this gives you an alternative to select which databases to clean up. I selected all of them since they all probably need it. This can take a long time to run, for this site it took 40 minutes to run all three databases with master and web being 20 GB of size.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 850px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/78c2168e8c5355183edcf3b8ad700d01/ae694/clean-up-databases.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 35.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABVUlEQVQoz42QzWrCQBRG8youRMWFP2A3VkT0qcRnECy49xWKboSkMTEh0USxWtTGjSi4L7ULf08zA7UUXHTg8N25wz0MV1G7bTrtZ9qdDkavh2kY+L5P46lB7iFHPp+nWCzKTCQSxGIx4vG4rKPRKMlkUma1WsXzPJServGiqaiqimlZOMMh0+mUZrNJ4bFAuVymUqlQKpXIZDKkUinS6TTZbFbKhTgSiVCr1RiPxyhWKBH0RWoadreL6w7ko+M5zGYzgiBguVyyWq3+IHrz+VwymUywbRulb5oYeg8tvAxbLab1Oq434i2YMfpyOJ1O/OfsdjuMcF2KKYRhoYv9hfiuizf0eV1McD4M9p97jscjl8vlLufzWQo3mw3CpTiOg8CyLZn+aMRgMOA9eOdwPXC9Xm/cOz/97Xb7K3TDX0lELeThPheLxW1ADt333YTr9Rpd1/kG9vXFiRjYPRsAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Clean up databases"
        title="Clean up databases"
        src="/static/78c2168e8c5355183edcf3b8ad700d01/ae694/clean-up-databases.png"
        srcset="/static/78c2168e8c5355183edcf3b8ad700d01/e85cb/clean-up-databases.png 480w,
/static/78c2168e8c5355183edcf3b8ad700d01/ae694/clean-up-databases.png 850w"
        sizes="(max-width: 850px) 100vw, 850px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>What this job does is to run the following functions:</p>
<ul>
<li>Cleanup CyclicDependences (items that couldn’t be removed by CleanupOrphans because they have a parent but are not in the item tree)</li>
<li>Cleanup InvalidLanguageData (remove all data from items in languages that are not defined as a valid language in the Sitecore system)</li>
<li>Cleanup Fields (delete data from fields -SharedFields, UnversionedFields, VersionedFields- that have no related item anymore)</li>
<li>Cleanup Orphans (delete items that have no parent anymore)</li>
<li>Cleanup Blobs (delete blob fields that have no related field)</li>
<li>Cleanup OrphanFields (clean the field data from the orphans removed in 4)</li>
<li>RebuildDescendants</li>
<li>Clear All Caches</li>
</ul>
<h1>SQL Fragmentation <a id="fragmentation"></a></h1>
<p>Fragmentation in the SQL database can cause serious performance issues. Thanks to <a href="https://mikael.com/2019/02/defragment-the-sql-server-heap-on-sitecore-databases/" target="_blank" rel="nofollow noopener noreferrer">this blog post</a> I got two SQL scripts that can make me find and fix the problem somewhat, and by somewhat it is that the fragmentation is only fixed for tables with an Index.
I ran the scripts on my core, master and web databases.</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> dbschemas<span class="token punctuation">.</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token string">'Schema'</span><span class="token punctuation">,</span>
  dbtables<span class="token punctuation">.</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token string">'Table'</span><span class="token punctuation">,</span>
  dbindexes<span class="token punctuation">.</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token string">'Index'</span><span class="token punctuation">,</span>
  indexstats<span class="token punctuation">.</span>alloc_unit_type_desc<span class="token punctuation">,</span>
  indexstats<span class="token punctuation">.</span>avg_fragmentation_in_percent<span class="token punctuation">,</span>
  indexstats<span class="token punctuation">.</span>page_count
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_db_index_physical_stats <span class="token punctuation">(</span>DB_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> indexstats
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> dbtables <span class="token keyword">on</span> dbtables<span class="token punctuation">.</span><span class="token punctuation">[</span>object_id<span class="token punctuation">]</span> <span class="token operator">=</span> indexstats<span class="token punctuation">.</span><span class="token punctuation">[</span>object_id<span class="token punctuation">]</span>
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>schemas dbschemas <span class="token keyword">on</span> dbtables<span class="token punctuation">.</span><span class="token punctuation">[</span>schema_id<span class="token punctuation">]</span> <span class="token operator">=</span> dbschemas<span class="token punctuation">.</span><span class="token punctuation">[</span>schema_id<span class="token punctuation">]</span>
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>indexes <span class="token keyword">AS</span> dbindexes <span class="token keyword">ON</span> dbindexes<span class="token punctuation">.</span><span class="token punctuation">[</span>object_id<span class="token punctuation">]</span> <span class="token operator">=</span> indexstats<span class="token punctuation">.</span><span class="token punctuation">[</span>object_id<span class="token punctuation">]</span>
<span class="token operator">AND</span> indexstats<span class="token punctuation">.</span>index_id <span class="token operator">=</span> dbindexes<span class="token punctuation">.</span>index_id
<span class="token keyword">WHERE</span> indexstats<span class="token punctuation">.</span>database_id <span class="token operator">=</span> DB_ID<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> indexstats<span class="token punctuation">.</span>avg_fragmentation_in_percent <span class="token keyword">desc</span></code></pre></div>
<p>This script shows the fragmentation of the different tables in the database. And as seen below it was quite extensive on my master db.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 681px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/70291c5a64ebe2c5efd7cfcbaeb7e44e/8ce52/fragmentation.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 92.91666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHElEQVQ4y11UB3LiQBDk/z+zXb4j2CAhJFAOgAJJgTDXPYCwT1VUScts73SYHbheIK4fShwnUhSlNE0jaZpJWZbStq1UVSWu68lq5UqeFxIGoSwWtrj4zrK1FHkuQRCgvpLz+SwDHwXlbi/L5VJBm6YWDwBpmgqf0/EopjkXGyBdd0bdSmazmRhYu1yvCpJg3/MZbLdb6c6dOLYt0+lMu/Q8T7vYbLZSFoWYxlzmcwuHtXrwcDiU6cyQKwDJIo5jud1u+huQUtt1EoYhWg8flFNQKbTgdDopZf7XoY6bbctWCQjItaIoXoCbzUZBHNtR7S6Xi77HyZ3y4XBAdwtd42bXdWUGJqZpai3XuO+GWgXM1pl2SMrj8VjW640K7kArBdzvAWDI3LSUHrUcDUdizF6Aa5gjT0C2y0V2eoQBpBhFkVBbNeU/ylEUA9wUx3F6wBK69x2mWSpN2yiVDo7xoT6W5ej78XDE+4syD/uajNX56/WmXeeITt9hnCQPKgupoeXtdgW4IUlKwD00zOG+AadN1HWygsvvb2/y/T1VAOqfb38AMsDsLAUw6dw1CSC0Bwlyqes9YuRroJlDJoDd+r5/d/nc6Rrf75Tx0XboEKaQWlWVKDZQZOPMSkEtxMRxlnpYAKDZdCoGOn7G5lcOEwKCMk+l8HwPA18m45HsdqXUp6MGnpqRHoP99/OPfGPtGewsy364DMocnyiM1DkWMAbMVguKdV2rSb4f9KYwOly7XNhh+wj2M4fZPYcr5I5Fu12FTRM5XyKcmcLlFGPoaGcEpJakzJl+dsjI9R0mdBmFC8tSnZrmBJ0+IDY1XCHYASibOhnczEz++fx8UYYMxPgd7IfLPHW/38lm/QUZOCkegp1gcnylzNikGEmbucThDLbKhXT0Lmfr9eNkV2+Xrmvg2hBrSxS4oIzLwF6pJDq3ONjATUPAl8uJXHuXUcBF0zAwyxPE5ACD5nBuAbHZ8QYhNhSEdT6uto/3dxmNxg9TOjWpj01e5Bi9VsXW2HS83wB04MAf0SHvx0D/JxM2wAuVM066TAHnnvQJ+A93KpfUtg/HsQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Fragmentation"
        title="Fragmentation"
        src="/static/70291c5a64ebe2c5efd7cfcbaeb7e44e/8ce52/fragmentation.png"
        srcset="/static/70291c5a64ebe2c5efd7cfcbaeb7e44e/e85cb/fragmentation.png 480w,
/static/70291c5a64ebe2c5efd7cfcbaeb7e44e/8ce52/fragmentation.png 681w"
        sizes="(max-width: 681px) 100vw, 681px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">DECLARE</span> <span class="token variable">@TableName</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> TableCursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>
<span class="token keyword">SELECT</span> table_name <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">WHERE</span> table_type <span class="token operator">=</span> <span class="token string">'base table'</span>
<span class="token keyword">OPEN</span> TableCursor
    <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> TableCursor <span class="token keyword">INTO</span> <span class="token variable">@TableName</span>
    <span class="token keyword">WHILE</span> @<span class="token variable">@FETCH_STATUS</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">BEGIN</span>
        <span class="token keyword">DBCC</span> DBREINDEX<span class="token punctuation">(</span><span class="token variable">@TableName</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span>
        <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> TableCursor <span class="token keyword">INTO</span> <span class="token variable">@TableName</span>
    <span class="token keyword">END</span>
<span class="token keyword">CLOSE</span> TableCursor
<span class="token keyword">DEALLOCATE</span> TableCursor</code></pre></div>
<p>This script reindexes the database and thus fixes some of the fragmentation. Although not percect, the scores are way better than before.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 684px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d2e000febbffc25bc4a2f22b3f740424/2c288/defragmentation.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 91.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC/0lEQVQ4y2VUiXKiQBT0/78tKTcVI6CAXHINIIrI4NXbb1CT3UyVJcd7Pf26e5hlWQ5n7SGMEgRBgEGP6LoGaWrhdqtwv1fI0hiW5SBJEux2LZbLJebzOWtSDMPA9ymapsH1esVs17aoeXM6nRBFEaI4QdvmqOsPggUAQlQqxZqbStNpOMH3fdiWTfAdZNV1jXEczfXssN9jz9+oNRKCdd2Ru+6glABGLIlRVRl8L0BTN4ZRsAmwclaGrayGgOfzmfV3zGTXqq5MoeM4sFl4PNbI8/kLsMgTMlqhLEtO0sNdu1h8LripMoBlUeDQdRNDARTKfd+bUaqqQU/ALHsz4wIRryMCLLlJDq0HfC2+8P72zvvCgKTbLWXaT4BVVZFhbRiuyLAoFJsOLPrDMWKW5Hy2hW2TYVGaOt/zzTTSK0uYigcGUIRtqaGmhgUb7nx4uYyIYx/NruTdlaYoeK4/mcKRh0GbZtFMftIrDhsNZRcZWR56nseGgcwGRmJFYHGxI2ABl4B1VeNEabQeH4D4DSisSqXMQ8d2CLoxrhb5JwtStmXUKmH27MkU0Zoj27aMXBtgmWAcz9PIRTkBijbW0uKoW74csNlYbBANewJmNMKiJAXNO3KihvHqDAlZh8MB58tlAlSqMsGWl+KyhFuyGAYx0qxgRo/GjJWzfjHcblOemq0BkiWG3G637xy2+9YwlFhIWI/HPaPi8b8wGipqKGGWRqkTLctS8X1vAHfEeJ6amXqYIqNEYcSd7jiPPc/1B891xpKWzZkxRZoEUNg8XZa15/Ht+0dshNVkymDS3zQtXdYIQ5evRegL2aZYLKZgD0zBhXoJ2BNYnr1GFqHVA1AOfBTFvKaG4ZLpTwhe0wya8mW9AK+X6yuDTw2/c8hxZRT5WsjIIrbWJ36SAt6vaRAloSwS7Jb66uE7c09WIsMLUPSTT5gBpMMhQbXuyconWPYyZeMH5rz/DPFz5H8YilvqkUMJtut65mi5/P7J+R35WVKscX6c5f81lAmfmfwL6sxWic6dhggAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="After defragmentation"
        title="After defragmentation"
        src="/static/d2e000febbffc25bc4a2f22b3f740424/2c288/defragmentation.png"
        srcset="/static/d2e000febbffc25bc4a2f22b3f740424/e85cb/defragmentation.png 480w,
/static/d2e000febbffc25bc4a2f22b3f740424/2c288/defragmentation.png 684w"
        sizes="(max-width: 684px) 100vw, 684px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h1>Remove old item versions <a id="remove"></a></h1>
<p>The final thing I did was to get rid of old versions of items. Being a multilanguage site with active content work and workflows some items had over 60 versions. To battle this I made a simple PowerShell script which will remove X old versions so that each item only has a select number of versions saved. This script is not a perfect solution as I need to run it manually, but I will add running it to my monthly maintenance round.</p>
<p>There are also some limitations as it limits the versions depending on the item version number on the webdatabase. Not counting for that there might be versions removed manually before the last version in web database.</p>
<p><div id="gist108867782" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-sitecore-remove-old-item-versions-ps1" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-powershell  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">&lt;#</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-c">  This script will remove old versions of items in all languages so that the items only contains a selected number of versions.</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$item</span> <span class="pl-k">=</span> <span class="pl-c1">Get-Item</span> <span class="pl-k">-</span>Path <span class="pl-s"><span class="pl-pds">&quot;</span>master:\content<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$dialogProps</span> <span class="pl-k">=</span> <span class="pl-k">@</span>{</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Parameters</span> <span class="pl-k">=</span> <span class="pl-k">@</span>(</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC8" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">@</span>{ <span class="pl-smi">Name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>item<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Title</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Branch to analyse<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Root</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>/sitecore/content/Home<span class="pl-pds">&quot;</span></span>}<span class="pl-k">,</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">@</span>{ <span class="pl-smi">Name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>count<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Value</span><span class="pl-k">=</span><span class="pl-c1">10</span>; <span class="pl-smi">Title</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Max number of versions<span class="pl-pds">&quot;</span></span>;  <span class="pl-smi">Editor</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>number<span class="pl-pds">&quot;</span></span>}<span class="pl-k">,</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">@</span>{ <span class="pl-smi">Name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>remove<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Value</span><span class="pl-k">=</span><span class="pl-c1">$False</span>; <span class="pl-smi">Title</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Do you wish to remove items?<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Editor</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>check<span class="pl-pds">&quot;</span></span>}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC11" class="blob-code blob-code-inner js-file-line">    )</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC12" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Limit item version count<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC13" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Description</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Sitecore recommends keeping 10 or fewer versions on any item, but policy may dictate this to be a higher number.<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC14" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Width</span> <span class="pl-k">=</span> <span class="pl-c1">500</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC15" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Height</span> <span class="pl-k">=</span> <span class="pl-c1">280</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC16" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">OkButtonName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Proceed<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC17" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">CancelButtonName</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Abort<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC18" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC19" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-c1">Read-Variable</span> <span class="pl-smi">@dialogProps</span> </td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC21" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span>(<span class="pl-smi">$result</span> <span class="pl-k">-ne</span> <span class="pl-s"><span class="pl-pds">&quot;</span>ok<span class="pl-pds">&quot;</span></span>) {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC23" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">Close-Window</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC24" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">Exit</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC25" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC26" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$items</span> <span class="pl-k">=</span> <span class="pl-k">@</span>()</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC28" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">Get-Item</span> <span class="pl-k">-</span>Path master: <span class="pl-k">-</span>ID <span class="pl-smi">$item<span class="pl-smi">.ID</span></span> <span class="pl-k">-</span>Language <span class="pl-k">*</span> <span class="pl-k">|</span> <span class="pl-c1">ForEach-Object</span> { <span class="pl-smi">$items</span> <span class="pl-k">+=</span> <span class="pl-k">@</span>(<span class="pl-c1">$_</span>) <span class="pl-k">+</span> <span class="pl-k">@</span>((<span class="pl-c1">$_<span class="pl-smi">.Axes.GetDescendants</span></span>())) <span class="pl-k">|</span> <span class="pl-c1">Where-Object</span> { <span class="pl-c1">$_<span class="pl-smi">.Versions.Count</span></span> <span class="pl-k">-gt</span> <span class="pl-smi">$count</span> } <span class="pl-k">|</span> <span class="pl-c1">Initialize-Item</span> }</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$ritems</span> <span class="pl-k">=</span> <span class="pl-k">@</span>()</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC30" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">$items</span> <span class="pl-k">|</span> <span class="pl-c1">ForEach-Object</span> {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC31" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$webVersion</span> <span class="pl-k">=</span> <span class="pl-c1">Get-Item</span> <span class="pl-k">-</span>Path web: <span class="pl-k">-</span>ID <span class="pl-c1">$_<span class="pl-smi">.ID</span></span> <span class="pl-k">-</span>Language <span class="pl-c1">$_<span class="pl-smi">.Language</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC32" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> (<span class="pl-smi">$webVersion</span>) {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC33" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$minVersion</span> <span class="pl-k">=</span> <span class="pl-smi">$webVersion<span class="pl-smi">.Version.Number</span></span> <span class="pl-k">-</span> <span class="pl-smi">$count</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC34" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">$ritems</span> <span class="pl-k">+=</span> <span class="pl-c1">Get-Item</span> <span class="pl-k">-</span>Path master: <span class="pl-k">-</span>ID <span class="pl-c1">$_<span class="pl-smi">.ID</span></span> <span class="pl-k">-</span>Language <span class="pl-c1">$_<span class="pl-smi">.Language</span></span> <span class="pl-k">-</span>Version <span class="pl-k">*</span> <span class="pl-k">|</span> <span class="pl-c1">Where-Object</span> { <span class="pl-c1">$_<span class="pl-smi">.Version.Number</span></span> <span class="pl-k">-le</span> <span class="pl-smi">$minVersion</span> }</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC35" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC36" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC37" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> (<span class="pl-smi">$remove</span>) {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC38" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$toRemove</span> <span class="pl-k">=</span> <span class="pl-smi">$ritems<span class="pl-smi">.Count</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC39" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$ritems</span> <span class="pl-k">|</span> <span class="pl-c1">ForEach-Object</span> {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">$_</span> <span class="pl-k">|</span> <span class="pl-c1">Remove-ItemVersion</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC41" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC42" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">Show-Alert</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Removed <span class="pl-smi">$toRemove</span> versions<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC43" class="blob-code blob-code-inner js-file-line">} <span class="pl-k">else</span> {</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC44" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$reportProps</span> <span class="pl-k">=</span> <span class="pl-k">@</span>{</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC45" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Property</span> <span class="pl-k">=</span> <span class="pl-k">@</span>(</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC46" class="blob-code blob-code-inner js-file-line">            <span class="pl-s"><span class="pl-pds">&quot;</span>DisplayName<span class="pl-pds">&quot;</span></span><span class="pl-k">,</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC47" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">@</span>{<span class="pl-smi">Name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Version<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Expression</span><span class="pl-k">=</span>{<span class="pl-c1">$_<span class="pl-smi">.Version</span></span>}}<span class="pl-k">,</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC48" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">@</span>{<span class="pl-smi">Name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Path<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Expression</span><span class="pl-k">=</span>{<span class="pl-c1">$_<span class="pl-smi">.ItemPath</span></span>}}<span class="pl-k">,</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC49" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">@</span>{<span class="pl-smi">Name</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">&quot;</span>Language<span class="pl-pds">&quot;</span></span>; <span class="pl-smi">Expression</span><span class="pl-k">=</span>{<span class="pl-c1">$_<span class="pl-smi">.Language</span></span>}}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC50" class="blob-code blob-code-inner js-file-line">        )</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC51" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Versions proposed to remove<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC52" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">InfoTitle</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>Sitecore recommendation: Limit the number of versions of any item to the fewest possible.<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC53" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">InfoDescription</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">&quot;</span>The report shows all items that have more than &lt;b&gt;<span class="pl-smi">$count</span> versions&lt;/b&gt;.<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC54" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC55" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">$ritems</span> <span class="pl-k">|</span> <span class="pl-c1">Show-ListView</span> <span class="pl-smi">@reportProps</span></td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC56" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC57" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-sitecore-remove-old-item-versions-ps1-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-sitecore-remove-old-item-versions-ps1-LC58" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">Close-Window</span></td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/webbson/532c66d562a6905387ca3a141bdd10ad/raw/8d7f92129061f32f557241039da9699db4775d62/Sitecore%20remove%20old%20item%20versions.ps1" style="float:right">view raw</a>
        <a href="https://gist.github.com/webbson/532c66d562a6905387ca3a141bdd10ad#file-sitecore-remove-old-item-versions-ps1">Sitecore remove old item versions.ps1</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p>
<hr>
<p>With these steps done the site runs way smoother than before. There might come more posts on this matter as I’m not fully satisfied yet.</p></section><hr/></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/slow-login-on-sitecore-9.0.1/">← <!-- -->Slow login on Sitecore 9.0.1/9.0.2</a></li><li><a rel="next" href="/get-a-list-of-sitecore-users/">Get an exportable list of users in Sitecore using Sitecore Powershell<!-- --> →</a></li></ul></nav></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/sitecore-database-maintenance/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f5ec1ff06108d0c85bab.js"],"app":["/app-4dcf017b93828f5893f6.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-0f7c69e5657f66b20482.js"],"component---src-pages-about-jsx":["/component---src-pages-about-jsx-da46d6a0275b7e48705d.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-8849f056fe256532e6b1.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-a769558c1a4ee58ac85f.js"],"component---src-templates-blog-post-jsx":["/component---src-templates-blog-post-jsx-b61ec52d5f6953dc41cc.js"],"component---src-templates-tags-jsx":["/component---src-templates-tags-jsx-6b7286af3402e110bc96.js"]};/*]]>*/</script><script src="/polyfill-f5ec1ff06108d0c85bab.js" nomodule=""></script><script src="/component---src-templates-blog-post-jsx-b61ec52d5f6953dc41cc.js" async=""></script><script src="/b7ec4a9a53c2f60dbf6d272eea6248b905830475-fa24200736daf2b6b0f4.js" async=""></script><script src="/f392fca177af3aab4cc1b9f9883337b948fd7c96-f84e27f836a0b0d63dc2.js" async=""></script><script src="/commons-860bd8c08d74af16f8c7.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-4dcf017b93828f5893f6.js" async=""></script><script src="/framework-cd3e1e804d552fa282ef.js" async=""></script><script src="/webpack-runtime-075b5726bcd5216af51a.js" async=""></script></body></html>